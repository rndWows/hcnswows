<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <title>Bi√™n b·∫£n nghi·ªám thu</title>
    <meta name="csrf-token" content="MHMXdIG4tBlzbq7sMs8y0wjq43Dtbf8PaMgnKDS3">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="shortcut icon" href="https://rndwows.github.io/hcnswows/logowows.jpg" type="image/x-icon">
    <!-- jQuery library -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />

    <style>
        body {
            background: rgb(204, 204, 204);
            font-family: "Times New Roman", Times, serif;
        }

        .fixed-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 100%;
            max-width: 200px;
        }

        page {
            background: white;
            display: block;
            margin: 0 auto;
            margin-bottom: 0.5cm;
            box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
        }

        page[size="A4"][layout="landscape"] {
            width: 29.7cm;
            height: 100%;
        }

        .table {
            table-layout: fixed;
            width: 100%;
        }

        .col-stt {
            width: 5%;
        }

        .col-ten-sp {
            width: 10%;
        }

        .col-quy-cach {
            width: 40%;
        }

        .col-dvt {
            width: 6%;
        }

        .col-so-luong {
            width: 5%;
        }

        .col-link {
            width: 10%;
        }

        .col-thoi-gian {
            width: 16%;
        }

        .col-nghiem-thu {
            width: 8%;
        }

        .table th,
        .table td {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: normal;
            padding: 0.75rem;
            vertical-align: top;
            border-top: 1px solid #dee2e6;
        }

        @media print {

            /* Th√™m d√≤ng n√†y v√†o ph·∫ßn @media print hi·ªán t·∫°i */
            #content {
                zoom: 0.85 !important;
                /* Thu nh·ªè to√†n b·ªô n·ªôi dung */
            }
        }

        @media print {

            .table th,
            .table td {
                overflow: visible;
                white-space: normal;
                word-wrap: break-word;
            }

            .link-bangiao,
            .nguoi-tiepnhan {
                display: none;
            }

            .print-only {
                display: inline;
            }

            body,
            #content {
                margin: 0;
                box-shadow: 0;
                font-size: 18px !important;
            }

            h5 {
                font-size: 24px
            }

            .date-input {
                display: none;
            }

            .no-print {
                display: none !important;
            }

            .big-title {
                font-size: 18px !important;
            }

            .total-pay {
                font-size: 15px !important;
            }

            @page {
                size: auto;
            }

            #content-split {
                margin-top: 40px;
                position: absolute;
                top: 50%;
                width: 920px;
            }

            .height_hr {
                border-top: 3px dashed black;
                width: 100%;
                position: absolute;
                top: 49%;
            }

            #content-split .div-logo {
                position: relative;
                top: -10px;
                left: 10px;
            }

            #sequenceNumber {
                display: none;
            }

            .participant-row.empty {
                display: none !important;
            }

            .participant-table input[type="text"] {
                border: none;
                border-bottom: none !important;
                text-align: left;
                padding-left: 0;
                background: transparent;
                -webkit-box-shadow: none;
                box-shadow: none;
            }

            .participant-table td {
                text-align: left;
            }

            .company-header {
                text-align: left;
                font-weight: bold;
            }

            .print-align-left {
                text-align: left !important;
            }

            .participant-table input[type="text"]:focus {
                outline: none;
                border: none;
                -webkit-box-shadow: none;
                box-shadow: none;
            }

            .signature-input {
                display: none !important;
            }

            .print-only {
                display: block !important;
            }
        }

        #content {
            font-size: 13.5px;
            padding: 40px 40px;
        }

        .center {
            text-align: center;
        }

        .right {
            text-align: right;
        }

        .bold {
            font-weight: bold;
        }

        .big-title {
            font-size: 15px;
            text-transform: uppercase;
            font-weight: bold;
            padding-bottom: 5px;
        }

        #fixed-panel,
        #fixed-show-user,
        #fixed-show-reason {
            font-size: 13px;
        }

        #select-setup-print {
            position: relative;
            top: -2px;
            background-color: #17a2b8;
            color: white;
        }

        #setup-print {
            position: fixed;
            top: 480px;
            left: 30px;
            width: 150px;
            height: 54px;
            background-color: #ffffff;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
        }

        .heigth-90px {
            height: 90px !important;
        }

        #page {
            margin-top: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .center-content {
            text-align: center;
            vertical-align: middle;
        }

        hr {
            margin-top: 5px;
            margin-bottom: 5px;
        }

        .table-center th {
            text-align: center;
            vertical-align: middle;
        }

        .info_student {
            margin-top: 10px;
            text-align: justify;
        }

        .info_contract {
            margin-bottom: 5px !important
        }

        .preserve-format {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .table thead th {
            vertical-align: middle;
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .table-bordered {
            border: 1px solid #dee2e6;
        }

        .form-control.link-bangiao,
        .form-control.nguoi-tiepnhan {
            width: 100%;
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            line-height: 1.3;
            color: #495057;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            border-radius: 0.2rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .table td {
            padding: 0.4rem;
        }

        @media screen {
            .print-only {
                display: none;
            }

            .signature-input {
                display: block;
            }
        }

        .signature-input {
            font-weight: bold;
            padding: 5px;
            margin: 0;
            width: 100%;
        }

        .signature-input:focus {
            outline: none;
            border-bottom: 2px solid #555;
        }

        @media only screen and (max-width: 1024px) {
            #fixed-panel {
                display: none !important;
            }

            #list_option_print {
                display: none !important;
            }
        }

        @media screen and (max-width: 600px) {
            .table-responsive {
                overflow-x: auto;
            }
        }

        .participants-container {
            display: flex;
        }

        .participant-table {
            width: 100%;
            border-collapse: collapse;
        }

        .participant-table th,
        .participant-table td {
            padding: 5px;
            border: none;
        }

        .company-header {
            font-weight: bold;
            text-align: left;
        }

        .participant-table input[type="text"] {
            border: none;
            border-bottom: 1px solid #ccc;
            outline: none;
            padding: 2px;
            width: 70%;
        }

        .participant-table input[type="text"]:focus {
            border-bottom: 2px solid #555;
        }

        .participant-row {
            transition: opacity 0.3s ease;
        }

        .participant-row[style*="display: none"] {
            opacity: 0;
        }

        /* Checkbox styling */
        .checkbox-container {
            display: block;
            position: relative;
            cursor: pointer;
            font-size: 14px;
            user-select: none;
        }

        .checkbox-container input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 20px;
            width: 20px;
            background-color: #eee;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .checkbox-container:hover input~.checkmark {
            background-color: #ccc;
        }

        .checkbox-container input:checked~.checkmark {
            background-color: #2196F3;
        }

        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        .checkbox-container input:checked~.checkmark:after {
            display: block;
        }

        .checkbox-container .checkmark:after {
            left: 6px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 3px 3px 0;
            transform: rotate(45deg);
        }
    </style>
</head>

<body>
    <button onclick="print()" class="btn btn-info fixed-button" style="width: 100%"><i class="fa fa-print"></i> <span
            class="language_print">In</span></button>
    <page size="A4" id="page" layout="landscape">
        <div id="content">
            <div class="content_page1">
                <table style="width: 100%;">
                    <tr>
                        <td rowspan="4"> <img src="https://rndwows.github.io/hcnswows/logowows.jpg"
                                style="width: 100px; margin: -30px"></td>
                        <td style="width: 60%;" rowspan="4" class="center">
                            <h4 class="bold">C√îNG TY C·ªî PH·∫¶N T·∫¨P ƒêO√ÄN WOWS</h4>
                        </td>
                        <td style="font-size: 12px;">M√£ hi·ªáu: </td>
                        <td style="font-size: 12px;"><span>WS-KD-QT02/BM05</span></td>
                    </tr>
                    <tr>
                        <td style="font-size: 12px;"> L·∫ßn ban h√†nh: 01</td>
                        <td style="font-size: 12px;">Hi·ªáu ch·ªânh l·∫ßn: 00</td>
                    </tr>
                    <tr>
                        <td style="font-size: 12px;">Ng√†y ban h√†nh: <span>01/07/2024</span></td>
                        <td style="font-size: 12px;">Ng√†y hi·ªáu ch·ªânh: <span>00</span></td>
                    </tr>
                    <tr>
                        <td style="font-size: 12px;">S·ªë:</td>
                        <td style="font-size: 12px;">BNT-<span id="Tvt"></span>-<span id="currentDate"></span>-<input
                                type="text" id="sequenceNumber" class="no-print"
                                style="width: 40px; border: none; border-bottom: 1px solid black;"><span
                                id="sequenceNumberDisplay"></span>
                        </td>
                    </tr>
                </table>

                <div style="clear: both"></div>
                <br>
                <h2 style="text-align: center;" class="bold"><span>BI√äN B·∫¢N NGHI·ªÜM THU</span></h2>
                <i>H√¥m nay, &emsp; Ng√†y
                    <input type="text" id="day1" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="day1-print"></span>
                    Th√°ng
                    <input type="text" id="month1" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="month1-print"></span>
                    NƒÉm
                    <input type="text" id="year1" class="date-input"
                        style="width: 50px; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="year1-print"></span>
                </i>
                <br>
                <i>T·∫°i vƒÉn ph√≤ng c√¥ng ty: </i><span id="companyName"></span>
                <br>
                <i>ƒê·ªãa ch·ªâ: </i><span id="companyAddress"></span>
                <br>
                <div class="bold">1. Th·ªùi gian nghi·ªám thu: </div>
                <i>B·∫Øt ƒë·∫ßu: &emsp;
                    Gi·ªù
                    <input type="text" id="hour1" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="hour1-print"></span>
                    Ph√∫t
                    <input type="text" id="phut1" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="phut1-print"></span>
                    Ng√†y
                    <input type="text" id="day2" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="day2-print"></span>
                    Th√°ng
                    <input type="text" id="month2" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="month2-print"></span>
                    NƒÉm
                    <input type="text" id="year2" class="date-input"
                        style="width: 50px; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="year2-print"></span>
                </i> <br>
                <i>k·∫øt th√∫c: &emsp;
                    Gi·ªù
                    <input type="text" id="hour2" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="hour2-print"></span>
                    Ph√∫t
                    <input type="text" id="phut2" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="phut2-print"></span>
                    Ng√†y
                    <input type="text" id="day3" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="day3-print"></span>
                    Th√°ng
                    <input type="text" id="month3" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="month3-print"></span>
                    NƒÉm
                    <input type="text" id="year3" class="date-input"
                        style="width: 50px; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="year3-print"></span>
                </i>
                <br>
                <div class="bold">2. H·ªôi ƒë·ªìng nghi·ªám thu bao g·ªìm:</div>
                <div style="display: flex; justify-content: space-between;">

                    <div class="participants-container">
                        <div class="column">
                            <table class="participant-table">
                                <tr>
                                    <th colspan="6">ƒê·∫°i di·ªán ch·ªß ƒë·∫ßu t∆∞:</th>
                                </tr>
                                <tr class="participant-row">
                                    <td colspan="2">1. √îng/B√†: <input type="text" id="companyA-person1"
                                            class="participant-input"></td>
                                    <td colspan="2">Ch·ª©c v·ª•: <input type="text" id="companyA-position1"
                                            class="participant-input"></td>
                                </tr>
                                <tr class="participant-row">
                                    <td colspan="2">2. √îng/B√†: <input type="text" id="companyA-person2"
                                            class="participant-input"></td>
                                    <td colspan="2">Ch·ª©c v·ª•: <input type="text" id="companyA-position2"
                                            class="participant-input"></td>
                                </tr>
                                <tr class="participant-row">
                                    <td colspan="2">3. √îng/B√†: <input type="text" id="companyA-person3"
                                            class="participant-input"></td>
                                    <td colspan="2">Ch·ª©c v·ª•: <input type="text" id="companyA-position3"
                                            class="participant-input"></td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="participants-container">
                        <div class="column">
                            <table class="participant-table">
                                <tr>
                                    <th colspan="6">ƒê·∫°i di·ªán ƒë∆°n v·ªã cung c·∫•p: C√¥ng ty C·ªï Ph·∫ßn T·∫≠p ƒëo√†n WOWS</th>
                                </tr>
                                <tr class="participant-row">
                                    <td colspan="2">1. √îng/B√†: <input type="text" id="companyB-person1"
                                            class="participant-input"></td>
                                    <td colspan="2">Ch·ª©c v·ª•: <input type="text" id="companyB-position1"
                                            class="participant-input"></td>
                                </tr>
                                <tr class="participant-row">
                                    <td colspan="2">2. √îng/B√†: <input type="text" id="companyB-person2"
                                            class="participant-input"></td>
                                    <td colspan="2">Ch·ª©c v·ª•: <input type="text" id="companyB-position2"
                                            class="participant-input"></td>
                                </tr>
                                <tr class="participant-row">
                                    <td colspan="2">3. √îng/B√†: <input type="text" id="companyB-person3"
                                            class="participant-input"></td>
                                    <td colspan="2">Ch·ª©c v·ª•: <input type="text" id="companyB-position3"
                                            class="participant-input"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="bold">3. H·ªôi ƒë·ªìng nghi·ªám thu ƒë√£ ti·∫øn h√†nh:</div>
                <div>Xem x√©t h·ªì s∆° t√†i li·ªáu sau:</div>
                <div>B√°o gi√°/h·ª£p ƒë·ªìng s·ªë: <span id="id" class="bold"></span></div>
                <p class="bold">Ki·ªÉm tra th·ª±c t·∫ø th√¥ng tin t√≠nh nƒÉng c·ªßa s·∫£n ph·∫©m d·ªãch v·ª• theo danh m·ª•c:</p>

                <table class="table table-bordered">
                    <thead class="center-content">
                        <tr>
                            <th class="center col-stt" rowspan="2">STT</th>
                            <th class="col-ten-sp" rowspan="2">T√™n s·∫£n ph·∫©m</th>
                            <th class="col-quy-cach" rowspan="2">M√¥ t·∫£ s·∫£n ph·∫©m</th>
                            <th class="col-dvt" rowspan="2">ƒê∆°n v·ªã t√≠nh</th>
                            <th class="col-so-luong" rowspan="2">S·ªë l∆∞·ª£ng</th>
                            <th class="col-link" rowspan="2">Link b√†n giao (N·∫øu c√≥)</th>
                            <th class="col-thoi-gian" colspan="2">Th·ªùi gian th·ª≠</th>
                            <th class="col-nghiem-thu" rowspan="2">K·∫øt qu·∫£ nghi·ªám thu</th>
                        </tr>
                        <tr>
                            <th>B·∫Øt ƒë·∫ßu</th>
                            <th>Ho√†n th√†nh</th>
                        </tr>
                    </thead>
                    <tbody id="orderDetailsBody">
                        <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn v√†o ƒë√¢y b·∫±ng JavaScript -->
                    </tbody>
                </table>

                <div class="bold">4. Nh·ªØng s·ª≠a ƒë·ªïi l·ªõn so v·ªõi y√™u c·∫ßu ban ƒë·∫ßu:</div>
                <i>
                    <input type="text" id="ghichu" class="date-input"
                        style="width: 100%; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="ghichu-print"></span>
                </i>
                <br>
                <div class="bold">5. Ki·∫øn ngh·ªã:</div>
                <i>
                    <input type="text" id="kiennghi" class="date-input"
                        style="width: 100%; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="kiennghi-print"></span>
                </i>
                <br>
                <div class="bold">6. K·∫øt lu·∫≠n:</div>
                <i>
                    <input type="text" id="ketluan" class="date-input"
                        style="width: 100%; border: none; border-bottom: 1px solid black;">
                    <span class="print-only" id="ketluan-print"></span>
                </i> <br>
                <i>X√°c nh·∫≠n c·ªßa c√°c th√†nh ph·∫ßn tham gia h·ªôi ƒë·ªìng nghi·ªám thu :</i>

                <div id="footerInfo" class="mt-4">
                    <!-- Th√¥ng tin cu·ªëi s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                </div>
            </div>
        </div>
    </page>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/printThis/1.15.0/printThis.min.js"
        integrity="sha512-d5Jr3NflEZmFDdFHZtxeJtBzk0eB+kkRXWFQqEc1EKmolXjHm2IKCA7kTvXBNjIYzjXfD5XzIjaaErpkZHCkBg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.centeronline.edu.vn/js/customer.js" type="text/javascript"></script>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbzbbhvgeKfcvQpwmbZtDwW2pbBtX0uX9HJ-ALRPH9YnpacpBjIMMwE5R3NMO6I6yy_GuQ/exec';

        // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u tr·ªØ d·ªØ li·ªáu
        var BAN_GIAO = {};
        var CT_BANGIAO = [];
        var KHTN = {};
        var DKTT = [];

        function searchContract(soBG) {
            console.log('üîç B·∫Øt ƒë·∫ßu t√¨m ki·∫øm v·ªõi SOBG:', soBG);

            if (!soBG) {
                console.error('‚ùå S·ªë h·ª£p ƒë·ªìng kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng');
                return;
            }

            console.log('üì° ƒêang g·ªçi API...');

            fetch(`${API_URL}?SOBG=${encodeURIComponent(soBG)}`)
                .then(response => {
                    console.log('üì• Response nh·∫≠n ƒë∆∞·ª£c:', response.status);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('‚úÖ Data nh·∫≠n ƒë∆∞·ª£c:', data);

                    if (data.success) {
                        BAN_GIAO = data.ban_giao || {};
                        CT_BANGIAO = data.chitiet_bangiao || [];
                        KHTN = data.khtn || {};
                        DKTT = data.hd || []; // S·ª≠a t·ª´ dktt th√†nh hd

                        console.log('üìä D·ªØ li·ªáu ƒë√£ parse:');
                        console.log('- BAN_GIAO:', BAN_GIAO);
                        console.log('- CT_BANGIAO:', CT_BANGIAO);
                        console.log('- KHTN:', KHTN);

                        updateUI();
                    } else {
                        console.error('‚ùå API tr·∫£ v·ªÅ l·ªói:', data.message);
                        alert('L·ªói t·ª´ server: ' + (data.message || 'Kh√¥ng x√°c ƒë·ªãnh'));
                    }
                })
                .catch(error => {
                    console.error('‚ùå L·ªói khi g·ªçi API:', error);
                    alert('ƒê√£ x·∫£y ra l·ªói khi t·∫£i d·ªØ li·ªáu: ' + error.message);
                });
        }

        function updateUI() {
            console.log('üîÑ B·∫Øt ƒë·∫ßu c·∫≠p nh·∫≠t UI...');

            try {
                // C·∫≠p nh·∫≠t s·ªë h·ª£p ƒë·ªìng
                const idContainer = document.getElementById('id');
                if (idContainer) {
                    const input = idContainer.querySelector('input');
                    const printSpan = idContainer.querySelector('.print-only');

                    const soHD = BAN_GIAO['S·ªë Hƒê'] || '';
                    console.log('üìÑ S·ªë Hƒê:', soHD);

                    if (input) input.value = soHD;
                    if (printSpan) printSpan.textContent = soHD;
                }

                // C·∫≠p nh·∫≠t th√¥ng tin c√¥ng ty
                const companyName = KHTN['T√äN C√îNG TY'] || '';
                const companyAddress = KHTN['ƒê·ªäA CH·ªà'] || '';
                const tenVietTat = KHTN['T√äN VI·∫æT T·∫ÆT'] || '';

                console.log('üè¢ Th√¥ng tin c√¥ng ty:', { companyName, companyAddress, tenVietTat });

                const companyNameEl = document.getElementById('companyName');
                const companyAddressEl = document.getElementById('companyAddress');
                const tvtEl = document.getElementById('Tvt');

                if (companyNameEl) companyNameEl.textContent = companyName;
                if (companyAddressEl) companyAddressEl.textContent = companyAddress;
                if (tvtEl) tvtEl.textContent = tenVietTat;

                console.log('üìã C·∫≠p nh·∫≠t b·∫£ng s·∫£n ph·∫©m...');
                updateProductTable();

                console.log('üîó Th√™m event listeners...');
                addInputListeners();

                console.log('üìù C·∫≠p nh·∫≠t footer...');
                updateFooter();

                console.log('‚úÖ Ho√†n th√†nh c·∫≠p nh·∫≠t UI');

            } catch (error) {
                console.error('‚ùå L·ªói trong updateUI:', error);
                alert('L·ªói khi c·∫≠p nh·∫≠t giao di·ªán: ' + error.message);
            }
        }

        function updateProductTable() {
            console.log('üìä C·∫≠p nh·∫≠t b·∫£ng v·ªõi d·ªØ li·ªáu:', CT_BANGIAO);

            const tableBody = document.getElementById('orderDetailsBody');
            if (!tableBody) {
                console.error('‚ùå Kh√¥ng t√¨m th·∫•y element orderDetailsBody');
                return;
            }

            if (!CT_BANGIAO || CT_BANGIAO.length === 0) {
                console.log('‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu chi ti·∫øt b√†n giao');
                tableBody.innerHTML = '<tr><td colspan="9" class="center">Kh√¥ng c√≥ d·ªØ li·ªáu s·∫£n ph·∫©m</td></tr>';
                return;
            }

            try {
                const htmlContent = CT_BANGIAO.map((item, index) => {
                    console.log(`üì¶ X·ª≠ l√Ω item ${index}:`, item);

                    return `
                    <tr>
                        <td class="center">${index + 1}</td>
                        <td>${item['Ten_hang_hoa/dich_vu'] || item['T√™n s·∫£n ph·∫©m'] || ''}</td>
                        <td class="preserve-format">${item['Chi_tiet_hang_hoa'] || item['M√¥ t·∫£'] || ''}</td>
                        <td>${item['DVT'] || item['ƒê∆°n v·ªã t√≠nh'] || ''}</td>
                        <td class="center">${item['So_luong'] || item['S·ªë l∆∞·ª£ng'] || ''}</td>
                        <td class="preserve-format">
                            <input type="text" class="form-control link-bangiao" value="${item['Link_bangiao'] || ''}" placeholder="Link b√†n giao">
                            <span class="print-only">${item['Link_bangiao'] || ''}</span>
                        </td>
                        <td>
                            <input type="text" class="form-control nguoi-tiepnhan" placeholder="T·ª´ ng√†y" value="">
                            <span class="print-only"></span>
                        </td>
                        <td>
                            <input type="text" class="form-control nguoi-tiepnhan" placeholder="ƒê·∫øn ng√†y" value="">
                            <span class="print-only"></span>
                        </td>
                        <td class="center">
                            <label class="checkbox-container no-print">
                                <input type="checkbox" class="form-control ket-quanghiemthu">
                                <span class="checkmark"></span>
                            </label>
                            <span class="print-only ket-qua-text">Ch∆∞a ki·ªÉm tra</span>
                        </td>
                    </tr>
                `;
                }).join('');

                tableBody.innerHTML = htmlContent;
                console.log('‚úÖ ƒê√£ c·∫≠p nh·∫≠t b·∫£ng th√†nh c√¥ng');

            } catch (error) {
                console.error('‚ùå L·ªói khi t·∫°o HTML cho b·∫£ng:', error);
                tableBody.innerHTML = '<tr><td colspan="9" class="center">L·ªói khi hi·ªÉn th·ªã d·ªØ li·ªáu</td></tr>';
            }
        }

        // ƒê∆°n gi·∫£n h√≥a addInputListeners ƒë·ªÉ tr√°nh v√≤ng l·∫∑p
        function addInputListeners() {
            console.log('üîó ƒêang th√™m event listeners...');

            try {
                // Ch·ªâ th√™m listener cho c√°c element m·ªõi, tr√°nh duplicate
                const inputs = document.querySelectorAll('.link-bangiao, .nguoi-tiepnhan');
                console.log('üìù T√¨m th·∫•y', inputs.length, 'inputs');

                inputs.forEach((input, index) => {
                    // Ki·ªÉm tra xem ƒë√£ c√≥ listener ch∆∞a
                    if (!input.hasAttribute('data-listener-added')) {
                        const printSpan = input.nextElementSibling;
                        if (printSpan && printSpan.classList.contains('print-only')) {
                            printSpan.textContent = input.value;

                            input.addEventListener('input', function () {
                                printSpan.textContent = this.value;
                            });

                            input.setAttribute('data-listener-added', 'true');
                        }
                    }
                });

                // X·ª≠ l√Ω checkbox
                const checkboxes = document.querySelectorAll('.ket-quanghiemthu');
                console.log('‚òëÔ∏è T√¨m th·∫•y', checkboxes.length, 'checkboxes');

                checkboxes.forEach(checkbox => {
                    if (!checkbox.hasAttribute('data-listener-added')) {
                        const printSpan = checkbox.closest('td').querySelector('.ket-qua-text');
                        if (printSpan) {
                            checkbox.addEventListener('change', function () {
                                printSpan.textContent = this.checked ? 'ƒê·∫°t' : 'Kh√¥ng ƒë·∫°t';
                            });

                            checkbox.setAttribute('data-listener-added', 'true');
                        }
                    }
                });

                console.log('‚úÖ Ho√†n th√†nh th√™m listeners');

            } catch (error) {
                console.error('‚ùå L·ªói khi th√™m listeners:', error);
            }
        }

        // C√°c function kh√°c gi·ªØ nguy√™n nh∆∞ng th√™m try-catch
        function updateFooter() {
            try {
                const footerInfo = document.getElementById('footerInfo');
                if (!footerInfo) return;

                let footerHTML = `
                <table style="width: 100%; text-align: center;">
                    <tbody>
                        <tr>
                            <td style="width: 50%;"><span class="bold">ƒê·∫°i di·ªán ƒë∆°n v·ªã cung c·∫•p</span></td>
                            <td style="width: 50%;"><span class="bold">ƒê·∫°i di·ªán ch·ªß ƒë·∫ßu t∆∞</span></td>
                        </tr>
                        <tr>
                            <td style="width: 50%;"><span class="bold">C√îNG TY C·ªî PH·∫¶N T·∫¨P ƒêO√ÄN WOWS</span></td>
                            <td style="width: 50%;"><span class="bold">${KHTN['T√äN C√îNG TY'] || 'T√äN C√îNG TY'}</span></td>
                        </tr>
                        <tr>
                            <td>(K√Ω, ƒë√≥ng d·∫•u v√† ghi r√µ h·ªç t√™n) <br><br><br><br><br><br></td>
                            <td>(K√Ω, ƒë√≥ng d·∫•u v√† ghi r√µ h·ªç t√™n) <br><br><br><br><br><br></td>
                        </tr>
                        <tr>
                            <td>
                                <input type="text" class="bold signature-input no-print" value="B√Ä ƒê·ªñ TH·ªä KIM TH·ª¶Y" style="text-align: center; width: 100%; border: none; border-bottom: 1px solid #ccc;">
                                <p class="bold print-only signature-text">B√Ä ƒê·ªñ TH·ªä KIM TH·ª¶Y</p>
                            </td>
                            <td>
                                <input type="text" class="bold signature-input no-print" value="${KHTN['NG∆Ø·ªúI LI√äN H·ªÜ'] || 'NG∆Ø·ªúI LI√äN H·ªÜ'}" style="text-align: center; width: 100%; border: none; border-bottom: 1px solid #ccc;">
                                <p class="bold print-only signature-text">${KHTN['NG∆Ø·ªúI LI√äN H·ªÜ'] || 'NG∆Ø·ªúI LI√äN H·ªÜ'}</p>
                            </td>
                        </tr>
                        <tr>
                            <td><i>Ng√†y k√Ω: ..............................</i></td>
                            <td><i>Ng√†y k√Ω: ..............................</i></td>
                        </tr>
                    </tbody>
                </table>
            `;

                footerInfo.innerHTML = footerHTML;

            } catch (error) {
                console.error('‚ùå L·ªói trong updateFooter:', error);
            }
        }

        function print() {
            $('#content').printThis({
                debug: false,
                importCSS: true,
                importStyle: true,
                printContainer: true,
                pageTitle: "",
                removeInline: false,
                removeInlineSelector: "*",
                printDelay: 333,
                header: null,
                footer: null,
                base: false,
                formValues: true,
                canvas: false,
                removeScripts: false,
                copyTagClasses: false
            });
        }

        // DOMContentLoaded event
        document.addEventListener('DOMContentLoaded', function () {
            console.log('üöÄ DOM ƒë√£ load, kh·ªüi t·∫°o...');

            try {
                // Thi·∫øt l·∫≠p ng√†y th√°ng
                var today = new Date();
                var day = today.getDate();
                var month = today.getMonth() + 1;
                var year = today.getFullYear();

                // ƒêi·ªÅn ng√†y h√¥m nay
                const dateFields = ['day1', 'month1', 'year1', 'day2', 'month2', 'year2', 'day3', 'month3', 'year3'];
                dateFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        if (fieldId.includes('day')) {
                            field.value = day;
                        } else if (fieldId.includes('month')) {
                            field.value = month;
                        } else if (fieldId.includes('year')) {
                            field.value = year;
                        }
                    }
                });

                // Thi·∫øt l·∫≠p input cho s·ªë h·ª£p ƒë·ªìng
                const idSpan = document.getElementById('id');
                if (idSpan && !idSpan.querySelector('input')) {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.style.cssText = 'border: none; border-bottom: 1px solid #ccc; font-weight: bold; width: 200px; padding: 2px 5px;';
                    input.classList.add('no-print');

                    const printSpan = document.createElement('span');
                    printSpan.classList.add('print-only');
                    printSpan.style.cssText = 'display: none; font-weight: bold;';

                    input.addEventListener('input', function () {
                        printSpan.textContent = this.value;
                    });

                    idSpan.appendChild(input);
                    idSpan.appendChild(printSpan);
                }

                // Thi·∫øt l·∫≠p ng√†y hi·ªán t·∫°i
                var currentDateSpan = document.getElementById('currentDate');
                if (currentDateSpan) {
                    currentDateSpan.textContent = String(day).padStart(2, '0') + '.' + String(month).padStart(2, '0');
                }

                // T√¨m ki·∫øm h·ª£p ƒë·ªìng t·ª´ URL
                const urlParams = new URLSearchParams(window.location.search);
                const soBG = urlParams.get('SOBG');

                console.log('üîç SOBG t·ª´ URL:', soBG);

                if (soBG) {
                    // Delay m·ªôt ch√∫t ƒë·ªÉ ƒë·∫£m b·∫£o trang ƒë√£ render xong
                    setTimeout(() => {
                        searchContract(soBG);
                    }, 100);
                } else {
                    console.warn('‚ö†Ô∏è Kh√¥ng c√≥ SOBG trong URL');
                }

            } catch (error) {
                console.error('‚ùå L·ªói trong DOMContentLoaded:', error);
            }
        });
    </script>
</body>

</html>