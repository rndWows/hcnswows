
<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="utf-8">
  <title>Biên bản bàn giao</title>
  <meta name="csrf-token" content="MHMXdIG4tBlzbq7sMs8y0wjq43Dtbf8PaMgnKDS3">
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <link rel="shortcut icon" href="https://rndwows.github.io/hcnswows/logowows.jpg" type="image/x-icon">
  <!-- jQuery library -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>

  <!-- Popper JS -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

  <!-- Latest compiled JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />

  <style>
    body {
      background: rgb(204, 204, 204);
      font-family: "Times New Roman", Times, serif;
    }

    .fixed-button {
      position: fixed;
      bottom: 20px;
      /* Điều chỉnh vị trí từ dưới lên, bạn có thể thay đổi giá trị này */
      right: 20px;
      /* Điều chỉnh vị trí từ phải sang, bạn có thể thay đổi giá trị này */
      width: 100%;
      max-width: 200px;
      /* Điều chỉnh chiều rộng tối đa của button */
    }

    page {
      background: white;
      display: block;
      margin: 0 auto;
      margin-bottom: 0.5cm;
      box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
    }

    page[size="A4"][layout="landscape"] {
      width: 29.7cm;
      height: 100%;

    }


    .table {
      table-layout: fixed;
      width: 100%;
    }

    .col-stt {
      width: 5%;
    }

    .col-ma-sp {
      width: 10%;
    }

    .col-ten-sp {
      width: 10%;
    }

    .col-quy-cach {
      width: 25%;
    }

    .col-dvt {
      width: 6%;
    }

    .col-so-luong {
      width: 5%;
    }

    .col-tenuv {
      width: 10%;
    }


    .col-link {
      width: 10%;
    }

    .col-nguoi-nhan {
      width: 10%;
    }

    .col-ghi-chu {
      width: 10%;
    }

    .table th,
    .table td {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: normal;
    }




    @media print {

      .table th,
      .table td {
        overflow: visible;
        white-space: normal;
        word-wrap: break-word;
      }
      .table-controls {
      display: none !important;
    }
      .link-bangiao,
      .nguoi-tiepnhan {
        display: none;
      }

      .print-only {
        display: inline;
      }

      body,
      #content {
        margin: 0;
        box-shadow: 0;
        font-size: 18px !important;
      }

      h5 {
        font-size: 24px
      }

      .date-input {
        display: none;
      }

      .no-print .table-controls {
        display: none;
      }

      .big-title {
        font-size: 18px !important;
      }

      .total-pay {
        font-size: 15px !important;
      }

      @page {
        size: auto;
      }

      #content-split {
        margin-top: 40px;
        position: absolute;
        top: 50%;
        width: 920px;
      }

      .height_hr {
        border-top: 3px dashed black;
        width: 100%;
        position: absolute;
        top: 49%;
      }

      #content-split .div-logo {
        position: relative;
        top: -10px;
        left: 10px;
      }

      #sequenceNumber {
        display: none;
      }


    }

    #content {
      font-size: 13.5px;

    }


    .center {
      text-align: center;
    }

    .right {
      text-align: right;
    }

    .bold {
      font-weight: bold;
    }

    .big-title {
      font-size: 15px;
    }

    #fixed-panel,
    #fixed-show-user,
    #fixed-show-reason {
      font-size: 13px;
    }


    #content {
      padding: 40px 40px;
    }

    #select-setup-print {
      position: relative;
      top: -2px;
      background-color: #17a2b8;
      color: white;
    }

    #setup-print {
      position: fixed;
      top: 480px;
      left: 30px;
      width: 150px;
      height: 54px;
      background-color: #ffffff;
      padding: 10px;
      border-radius: 5px;
      /*font-size: 13px;*/
      box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
    }


    .heigth-90px {
      height: 90px !important;
    }

    #page {
      margin-top: 20px;
      margin-bottom: 20px;
      position: relative;
    }

    .center-content {
      text-align: center;
      vertical-align: middle;
    }

    .big-title {
      text-transform: uppercase;
      font-weight: bold;
      /*font-size: 15px;*/
      padding-bottom: 5px;
    }

    hr {
      margin-top: 5px;
      margin-bottom: 5px;
    }

    .bold {
      font-weight: bold;
    }

    .table-center th {
      text-align: center;
      vertical-align: middle;
    }

    .info_student {
      margin-top: 10px;
      text-align: justify;
    }

    .info_contract {
      margin-bottom: 5px !important
    }

    .preserve-format {
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .table thead th {
      vertical-align: middle;
      background-color: #f8f9fa;
      border-bottom: 2px solid #dee2e6;
    }

    d .table th,
    .table td {
      padding: 0.75rem;
      vertical-align: top;
      border-top: 1px solid #dee2e6;
    }

    .center {
      text-align: center;
    }

    .table-bordered {
      border: 1px solid #dee2e6;
    }


    .form-control.link-bangiao,
    .form-control.nguoi-tiepnhan {
      width: 100%;
      padding: 0.25rem 0.5rem;
      /* Giảm padding */
      font-size: 0.875rem;
      /* Giảm kích thước font */
      line-height: 1.3;
      /* Giảm line-height */
      color: #495057;
      background-color: #fff;
      background-clip: padding-box;
      border: 1px solid #ced4da;
      border-radius: 0.2rem;
      /* Giảm border-radius nếu cần */
      transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }

    /* Nếu bạn muốn giảm kích thước tổng thể của input */
    .table td {
      padding: 0.4rem;
      /* Giảm padding của ô td */
    }

    @media screen {
      .print-only {
        display: none;
      }
    }


    @media only screen and (max-width: 1024px) {
      #fixed-panel {
        display: none !important;
      }

      #list_option_print {
        display: none !important;
      }
    }

    @media print {
      .tranh-tach-trang {
        page-break-inside: avoid;
      }
    }
  </style>

</head>

<body>
  <button onclick="print()" class="btn btn-info fixed-button" style="width: 100%"><i class="fa fa-print"></i> <span
      class="language_print"></span></button>
      
  <page size="A4" id="page" layout="landscape">
    <div id="content">
      <div class="content_page1">
        <table style="width: 100%;">
          <tr>
            <th rowspan="4"> <img src="https://rndwows.github.io/hcnswows/logowows.jpg"
                style="width: 100px; margin: -30px"></th>
            <th style="width: 60%;" rowspan="4" class="center">
              <h4 class=" bold">CÔNG TY CỔ PHẦN TẬP ĐOÀN WOWS</h4>

            </th>
            <td style="font-size: 12px;">Mã hiệu: </th>
            <td style="font-size: 12px;"><span>WS-KD-QT02/BM04</span></th>
          </tr>
          <tr>
            <td style="font-size: 12px;"> Lần ban hành: 01</td>
            <td style="font-size: 12px;">Hiệu chỉnh lần: 00</td>
          </tr>
          <tr>
            <td style="font-size: 12px;">Ngày ban hành: <span>01/07/2024</td>
            <td style="font-size: 12px;">Ngày hiệu chỉnh: <span>00</td>
          </tr>
          <tr>
            <td style="font-size: 12px;">Số:</td>
            <!-- <td style="font-size: 12px;">BGO-<span id="Tvt"></span>-<span id="currentDate"></span>-<input type="text"
                id="sequenceNumber" class="no-print"
                style="width: 40px; border: none; border-bottom: 1px solid black;"><span
                id="sequenceNumberDisplay"></span>
            </td> -->
            <td style="font-size: 12px;"><span id="idBG"></span>
            </td>
          </tr>
        </table>


        <div style="clear: both"></div>
        <br>
        <h2 style="text-align: center;" class="bold"><span>BIÊN BẢN BÀN GIAO SẢN PHẨM/DỊCH VỤ
          </span></h2>



        <i colspan="4">Căn cứ vào hợp đồng kinh tế số: <span id="SoHD" class="bold"></span></i>
        <br>

        <i>Bình Dương, Ngày
          <input type="text" id="day" class="date-input" style="width: 15px; border: none;">
          Tháng
          <input type="text" id="month" class="date-input" style="width: 15px; border: none;">
          Năm
          <input type="text" id="year" class="date-input" style="width: 50px; border: none;">
        </i>



        <table style="width: 100%; border-collapse: collapse;">

          <tr class="bold">
            <td style="width: 25%;">Bên Cung cấp Dịch vụ (Bên A):</td>
            <td colspan="3">CÔNG TY CỔ PHẦN TẬP ĐOÀN WOWS</td>
          </tr>
          <tr>
            <td>Mã số doanh nghiệp:</td>
            <td colspan="3">3702278001</td>
          </tr>
          <tr>
            <td>Địa chỉ:</td>
            <td colspan="3">Thửa đất số 131, tờ bản đồ số 7, đường ĐT 747, Tổ 3, Phường Hội Nghĩa, Thành Phố
              Tân Uyên, Tỉnh Bình Dương</td>
          </tr>
          <tr>
            <td>Đại diện theo pháp luật:</td>
            <td class="bold">Bà Đỗ Thị Kim Thủy</td>
            <td style="width: 15%;" class="bold">Chức vụ:</td>
            <td>Tổng giám đốc</td>
          </tr>
          <tr class="bold">
            <td>Bên Yêu cầu Dịch vụ (Bên B):</td>
            <td colspan="3" style="color: blue;"><span id="companyName"></span></td>
          </tr>
          <tr>
            <td>Mã số doanh nghiệp:</td>
            <td colspan="3"><span id="Mst"></span></td>
          </tr>
          <tr>
            <td>Địa chỉ:</td>
            <td colspan="3"><span id="companyAddress"></span></td>
          </tr>
          <tr>
            <td>Đại diện:</td>
            <td class="bold"><span id="Nglh"></span></td>
            <td class="bold">Chức vụ:</td>
            <td><span id="Chucvu"></span></td>
          </tr>
          <tr>
            <td>Số điện thoại:</td>
            <td><span id="Sdt"></span></td>
            <td class="bold">Email:</td>
            <td><span id="Email"></span></td>
          </tr>



        </table>
        <i colspan="4">Hai bên cùng thống nhất bàn giao và nhận các sản phẩm/dịch vụ như sau:</i>



<!-- Thêm nút điều khiển phía trên bảng -->
<div class="table-controls mb-2 no-print">
    <button id="toggleColumnsBtn" class="btn btn-sm btn-info"><i class="fa fa-eye-slash"></i> Ẩn/Hiện cột</button>
    
    <!-- Popup chọn cột để ẩn/hiện -->
    <div id="columnsPopup" style="display: none; position: absolute; background: white; border: 1px solid #ddd; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 1000; width: 200px;">
      <div class="form-check">
        <input class="form-check-input toggle-column" type="checkbox" value="0" id="col-stt-check" checked>
        <label class="form-check-label" for="col-stt-check">STT</label>
      </div>
      <div class="form-check">
        <input class="form-check-input toggle-column" type="checkbox" value="1" id="col-ma-sp-check" checked>
        <label class="form-check-label" for="col-ma-sp-check">Mã sản phẩm</label>
      </div>
      <div class="form-check">
        <input class="form-check-input toggle-column" type="checkbox" value="2" id="col-ten-sp-check" checked>
        <label class="form-check-label" for="col-ten-sp-check">Tên sản phẩm</label>
      </div>
      <div class="form-check">
        <input class="form-check-input toggle-column" type="checkbox" value="3" id="col-quy-cach-check" checked>
        <label class="form-check-label" for="col-quy-cach-check">Mô tả sản phẩm</label>
      </div>
      <div class="form-check">
        <input class="form-check-input toggle-column" type="checkbox" value="4" id="col-dvt-check" checked>
        <label class="form-check-label" for="col-dvt-check">Đơn vị tính</label>
      </div>
      <div class="form-check">
        <input class="form-check-input toggle-column" type="checkbox" value="5" id="col-so-luong-check" checked>
        <label class="form-check-label" for="col-so-luong-check">Số lượng</label>
      </div>
      <div class="form-check">
        <input class="form-check-input toggle-column" type="checkbox" value="6" id="col-tenuv-check" checked>
        <label class="form-check-label" for="col-tenuv-check">Tên ứng viên</label>
      </div>
      <div class="form-check">
        <input class="form-check-input toggle-column" type="checkbox" value="7" id="col-link-check" checked>
        <label class="form-check-label" for="col-link-check">Link bàn giao</label>
      </div>
      <div class="form-check">
        <input class="form-check-input toggle-column" type="checkbox" value="8" id="col-nguoi-nhan-check" checked>
        <label class="form-check-label" for="col-nguoi-nhan-check">Người tiếp nhận</label>
      </div>
      <div class="form-check">
        <input class="form-check-input toggle-column" type="checkbox" value="9" id="col-ghi-chu-check" checked>
        <label class="form-check-label" for="col-ghi-chu-check">Ghi chú</label>
      </div>
      <button id="closePopupBtn" class="btn btn-sm btn-secondary mt-2">Đóng</button>
    </div>
  </div>
  
  <!-- Thêm form dialog để thêm cột mới -->
  <div id="addColumnDialog" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Thêm cột mới</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="addColumnForm">
            <div class="form-group">
              <label for="columnName">Tên cột</label>
              <input type="text" class="form-control" id="columnName" required>
            </div>
            <div class="form-group">
              <label for="columnWidth">Độ rộng (%)</label>
              <input type="number" class="form-control" id="columnWidth" value="10" min="5" max="30">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
          <button type="button" class="btn btn-primary" id="saveColumnBtn">Lưu</button>
        </div>
      </div>
    </div>
  </div>
        <table class="table table-bordered">
          <thead class="center-content">
            <tr>
              <th class="center col-stt">STT</th>
              <th class="col-ma-sp">Mã sản phẩm</th>
              <th class="col-ten-sp">Tên sản phẩm</th>
              <th class="col-quy-cach">Mô tả sản phẩm</th>
              <th class="col-dvt">Đơn vị tính</th>
              <th class="col-so-luong">Số lượng</th>
              <th class="col-tenuv">Tên ứng viên</th>
              <th class="col-link">Link bàn giao (Nếu có)</th>

              <th class="col-nguoi-nhan">Người tiếp nhận</th>
              <th class="center col-ghi-chu">Ghi chú</th>
            </tr>
          </thead>
          <tbody id="orderDetailsBody">
            <!-- Dữ liệu sẽ được điền vào đây bằng JavaScript -->
          </tbody>

        </table>

        <i>Hai bên đồng ý, thống nhất, và ký tên xác nhận. Biên bản này được lập thành 02 bản, mỗi bên giữ một
          bản và có giá trị pháp lý như nhau.</i>
        <div id="thanhToanInfo" class="mt-4">
          <!-- Thông tin thanh toán sẽ được thêm vào đây -->
        </div>
        <div id="footerInfo" class="mt-4">
          <!-- Thông tin cuối sẽ được thêm vào đây -->
        </div>
      </div>
    </div>
  </page>


  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/printThis/1.15.0/printThis.min.js"
    integrity="sha512-d5Jr3NflEZmFDdFHZtxeJtBzk0eB+kkRXWFQqEc1EKmolXjHm2IKCA7kTvXBNjIYzjXfD5XzIjaaErpkZHCkBg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.centeronline.edu.vn/js/customer.js" type="text/javascript"></script>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbzbbhvgeKfcvQpwmbZtDwW2pbBtX0uX9HJ-ALRPH9YnpacpBjIMMwE5R3NMO6I6yy_GuQ/exec';

    // Biến toàn cục để lưu trữ dữ liệu
    var BAN_GIAO = {};
    var CT_BANGIAO = [];
    var KHTN = {};
    var DKTT = [];

    function searchContract(soBG) {
      fetch(`${API_URL}?SOBG=${encodeURIComponent(soBG)}`)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            BAN_GIAO = data.ban_giao || {};
            CT_BANGIAO = data.chitiet_bangiao || [];
            KHTN = data.khtn || {};
            DKTT = data.dktt || [];

            updateUI();
          } else {
            console.error('Lỗi:', data.message);
          }
        })
        .catch(error => {
          console.error('Đã xảy ra lỗi:', error.message);
        });
    }

    function updateUI() {
      document.getElementById('idBG').textContent = BAN_GIAO['ID_BG'] || '';
      document.getElementById('SoHD').textContent = BAN_GIAO['Số HĐ'] || '';
      document.getElementById('companyName').textContent = KHTN['TÊN CÔNG TY'] || '';
      document.getElementById('companyAddress').textContent = KHTN['ĐỊA CHỈ'] || '';
      document.getElementById('Mst').textContent = KHTN['MST'] || '';
      document.getElementById('Nglh').textContent = KHTN['NGƯỜI LIÊN HỆ'] || '';
      document.getElementById('Chucvu').textContent = KHTN['CHỨC VỤ'] || '';
      document.getElementById('Sdt').textContent = KHTN['SỐ ĐT NGƯỜI LIÊN HỆ'] || '';
      document.getElementById('Email').textContent = KHTN['EMAIL NGƯỜI LIÊN HỆ'] || '';
    //   document.getElementById('Tvt').textContent = KHTN['TÊN VIẾT TẮT'] || '';
      
      updateProductTable();

      updateFooter();
    }

    function updateProductTable() {
      const tableBody = document.getElementById('orderDetailsBody');
      if (Array.isArray(CT_BANGIAO)) {
        tableBody.innerHTML = CT_BANGIAO.map((item, index) => `
        <tr>
            <td class="center">${index + 1}</td>
            <td>${item['Ma_HHDV'] || ''}</td>
            <td>${item['Ten_hang_hoa/dich_vu'] || ''}</td>
            <td class="preserve-format">${item['Chi_tiet_hang_hoa'] || ''}</td>
            <td>${item['DVT'] || ''}</td>
            <td>${item['So_luong'] || ''}</td>
            <td>${item['Tên ứng viên'] || ''}</td>
            <td class="preserve-format">${item['Link_bangiao'] || ''}</td>
            <td>${item['Nguoi_tiepnhan'] || ''}</td>
            <td>${item['Ghi chú'] || ''}</td>
        </tr>
    `).join('');
      } else {
        console.error('KHTK_DUAN is not an array');
        tableBody.innerHTML = '<tr><td colspan="9">Không có dữ liệu</td></tr>';
      }

    }



    function updateFooter() {
      const footerInfo = document.getElementById('footerInfo');
      let footerHTML = '';

      footerHTML += `
    <div class="tranh-tach-trang">
       <table style="width: 100%; text-align: center;">
            <tbody>
                <tr>
                    <td style="width: 50%;"><span class="bold">BÊN BÀN GIAO</span></td>
                    <td style="width: 50%;"><span class="bold">BÊN NHẬN BÀN GIAO</span></td>
                </tr>
                <tr>
                    <td style="width: 50%;"><span class="bold">CÔNG TY CỔ PHẦN TẬP ĐOÀN WOWS</span></td>
                    <td style="width: 50%;"><span class="bold" id="benb1">${KHTN['TÊN CÔNG TY'] || 'CÔNG TY TNHH MỘT THÀNH VIÊN ADL PAPERPACKAGING'}</span></td>
                </tr>
                <tr>
                    <td>(Ký, đóng dấu và ghi rõ họ tên) <br> <br> <br> <br> <br> <br> </td>
                    <td>(Ký, đóng dấu và ghi rõ họ tên) <br> <br> <br> <br> <br> <br> </td>
                </tr>
                <tr>
                    <td>
                        <p class="bold">BÀ ĐỖ THỊ KIM THỦY</p>
                    </td>
                    <td>
                        <p style="text-transform: uppercase;" class="bold"><span id="daidien1">${KHTN['NGƯỜI LIÊN HỆ'] || 'Ông Lê Văn Liêm'}</span></p>
                    </td>
                </tr>
                <tr>
                    <td>
                        <i class="">Ngày ký: .............................</i>
                    </td>
                    <td>
                        <i class="">Ngày ký: .............................</i>
                    </td>
                </tr>
            </tbody>
       </table>
    </div>
    `;

      footerInfo.innerHTML = footerHTML;
    }

    // (Giữ nguyên các hàm hỗ trợ như formatCurrency, formatDate, numberToWords)

    document.addEventListener('DOMContentLoaded', function () {
      const urlParams = new URLSearchParams(window.location.search);
      const soBG = urlParams.get('SOBG');
      if (soBG) {
        searchContract(soBG);
      } else {
        console.error('Vui lòng cung cấp số hợp đồng trong URL (ví dụ: ?SOBG=HD001)');
      }


      updateProductTable();
    });

    function formatDate(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      if (isNaN(date.getTime())) return dateString;
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = String(date.getFullYear());
      return `${day}/${month}/${year}`;
    }
    function formatCurrency(value) {
      if (!value) return '';
      return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(value);
    }

    function print() {
      $('#content').printThis({
        debug: false,
        importCSS: true,
        importStyle: true,
        printContainer: true,
        pageTitle: "",
        removeInline: false,
        removeInlineSelector: "*",
        printDelay: 333,
        header: null,
        footer: null,
        base: false,
        formValues: true,
        canvas: false,
        removeScripts: false,
        copyTagClasses: false,
        beforePrintEvent: null,
        beforePrint: null,
      });
    }

    document.addEventListener('DOMContentLoaded', function () {
      // Lấy ngày hôm nay
      var today = new Date();
      var day = today.getDate();
      var month = today.getMonth() + 1; // Tháng bắt đầu từ 0
      var year = today.getFullYear();

      // Điền ngày hôm nay vào các ô input
      document.getElementById('day').value = day;
      document.getElementById('month').value = month;
      document.getElementById('year').value = year;

    });

    // document.addEventListener('DOMContentLoaded', function () {
    //   // Lấy ngày hiện tại
    //   var today = new Date();
    //   var day = String(today.getDate()).padStart(2, '0');
    //   var month = String(today.getMonth() + 1).padStart(2, '0'); // Tháng bắt đầu từ 0

    //   // Điền ngày và tháng vào span
    // //   var currentDateSpan = document.getElementById('currentDate');
    // //   currentDateSpan.textContent = day + '.' + month;

    //   // Xử lý số thứ tự
    //   var sequenceInput = document.getElementById('sequenceNumber');
    //   var sequenceDisplay = document.getElementById('sequenceNumberDisplay');

    //   sequenceInput.addEventListener('input', function () {
    //     var value = this.value.padStart(3, '0');
    //     sequenceDisplay.textContent = value;
    //   });
    // });

// Xử lý ẩn/hiện cột và thêm cột mới
document.addEventListener('DOMContentLoaded', function() {
  // Cấu hình cho nút toggle columns
  const toggleColumnsBtn = document.getElementById('toggleColumnsBtn');
  const columnsPopup = document.getElementById('columnsPopup');
  const closePopupBtn = document.getElementById('closePopupBtn');
  const toggleColumnInputs = document.querySelectorAll('.toggle-column');
  
  toggleColumnsBtn.addEventListener('click', function(event) {
    event.stopPropagation();
    if (columnsPopup.style.display === 'none' || columnsPopup.style.display === '') {
      columnsPopup.style.display = 'block';
      const rect = toggleColumnsBtn.getBoundingClientRect();
      columnsPopup.style.top = (rect.bottom + window.scrollY) + 'px';
      columnsPopup.style.left = (rect.left + window.scrollX) + 'px';
    } else {
      columnsPopup.style.display = 'none';
    }
  });
  
  closePopupBtn.addEventListener('click', function() {
    columnsPopup.style.display = 'none';
  });
  
  // Đóng popup khi click bên ngoài
  document.addEventListener('click', function(event) {
    if (!columnsPopup.contains(event.target) && event.target !== toggleColumnsBtn) {
      columnsPopup.style.display = 'none';
    }
  });
  
  // Xử lý toggle columns
  toggleColumnInputs.forEach(input => {
    input.addEventListener('change', function() {
      const colIndex = parseInt(this.value);
      const table = document.querySelector('.table');
      const headerCells = table.querySelectorAll('thead th');
      const rows = table.querySelectorAll('tbody tr');
      
      if (this.checked) {
        // Hiện cột
        if (headerCells[colIndex]) headerCells[colIndex].style.display = '';
        rows.forEach(row => {
          const cell = row.cells[colIndex];
          if (cell) cell.style.display = '';
        });
      } else {
        // Ẩn cột
        if (headerCells[colIndex]) headerCells[colIndex].style.display = 'none';
        rows.forEach(row => {
          const cell = row.cells[colIndex];
          if (cell) cell.style.display = 'none';
        });
      }
    });
  });
  
  // Cấu hình nút thêm cột
  const addColumnBtn = document.getElementById('addColumnBtn');
  const addColumnDialog = document.getElementById('addColumnDialog');
  const saveColumnBtn = document.getElementById('saveColumnBtn');
  
  addColumnBtn.addEventListener('click', function() {
    $('#addColumnDialog').modal('show');
  });
  
  saveColumnBtn.addEventListener('click', function() {
    const columnName = document.getElementById('columnName').value;
    const columnWidth = document.getElementById('columnWidth').value;
    
    if (columnName) {
      // Thêm một cột mới vào thead
      const table = document.querySelector('.table');
      const thead = table.querySelector('thead tr');
      const newTh = document.createElement('th');
      newTh.className = 'center';
      newTh.textContent = columnName;
      newTh.style.width = columnWidth + '%';
      thead.appendChild(newTh);
      
      // Thêm một ô trống vào mỗi hàng trong tbody
      const rows = table.querySelectorAll('tbody tr');
      rows.forEach(row => {
        const newTd = document.createElement('td');
        newTd.contentEditable = 'true';
        row.appendChild(newTd);
      });
      
      // Thêm cột mới vào popup ẩn/hiện
      const newColIndex = thead.children.length - 1;
      const newCheck = document.createElement('div');
      newCheck.className = 'form-check';
      newCheck.innerHTML = `
        <input class="form-check-input toggle-column" type="checkbox" value="${newColIndex}" id="col-custom-${newColIndex}-check" checked>
        <label class="form-check-label" for="col-custom-${newColIndex}-check">${columnName}</label>
      `;
      columnsPopup.insertBefore(newCheck, closePopupBtn);
      
      // Thêm sự kiện cho checkbox mới
      const newInput = newCheck.querySelector('input');
      newInput.addEventListener('change', function() {
        const colIndex = parseInt(this.value);
        const headerCells = table.querySelectorAll('thead th');
        const rows = table.querySelectorAll('tbody tr');
        
        if (this.checked) {
          if (headerCells[colIndex]) headerCells[colIndex].style.display = '';
          rows.forEach(row => {
            const cell = row.cells[colIndex];
            if (cell) cell.style.display = '';
          });
        } else {
          if (headerCells[colIndex]) headerCells[colIndex].style.display = 'none';
          rows.forEach(row => {
            const cell = row.cells[colIndex];
            if (cell) cell.style.display = 'none';
          });
        }
      });
      
      // Đóng dialog
      $('#addColumnDialog').modal('hide');
      document.getElementById('columnName').value = '';
      document.getElementById('columnWidth').value = '10';
    }
  });
});


  </script>
</body>

</html>